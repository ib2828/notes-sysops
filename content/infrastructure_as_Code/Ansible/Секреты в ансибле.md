  
**Секреты в ансибле.**
  
1. У вас должен быть мастер-ключ, попросите его у тех у кого он уже есть

2. Кладем этот ключик себе в рабочую директорию(откуда будем ансибл дергать) в файл .vault

3. Экспортим его себе в энвы
export ANSIBLE_VAULT_PASSWORD_FILE=.vault

4. Шифруем секрет:  
❯ echo -n 'EpahX3OhtaipoaP' | ansible-vault encrypt_string  
Reading plaintext input from stdin. (ctrl-d to end input, twice if your content does not already have a newline)  
!vault |  
    $ANSIBLE_VAULT;1.1;AES256  
    64626333666166643335663063653435316332633130616539613563343138393166303865366164  
    3961613037626335383637323834353366663964353332610a616264343833376538653363666630  
    31656162366438623063643332303432633132333334366462363035653931616335653136336263  
    3262616233363361640a353764666339306236626439333161316564376534383061623931343234  
    3734  
Encryption successful5. Суем его себе в плейбук:

- task: "Secrets provisionins"  
  user: vasyan  
  pass: !vault |  
    $ANSIBLE_VAULT;1.1;AES256  
    646263336661666433356630636534353163326331306165396135633431383931663038653661643961613037626335383637323834353366663964353332610a616264343833376538653363666630316561623664386230636433323034326331323333343664623630356539316163356531363362633262616233363361640a3537646663393062366264393331613165643765343830616239313432343734

6. Либо присваем его переменной:

bla_bla_super_pass: !vault |  
$ANSIBLE_VAULT;1.1;AES256  
646263336661666433356630636534353163326331306165396135633431383931663038653661643961613037626335383637323834353366663964353332610a616264343833376538653363666630316561623664386230636433323034326331323333343664623630356539316163356531363362633262616233363361640a3537646663393062366264393331613165643765343830616239313432343734

А потом используем её в плейбуке

- task: "Secrets provisionins"  
  user: vasyan  
  pass: "{{ bla_bla_super_pass }}"

 
echo -n 'SenPasw178121red' | ansible-vault encrypt_string  
  
/usr/local/bin/ansible-playbook -b -i inventories/prod/hosts --limit web9b.city-srv.ru --tags web_apps playbooks/taxiserv_web.yml -CD --ask-vault-pass



#ansible/vault
